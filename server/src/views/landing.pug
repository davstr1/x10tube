extends layout

block content
  //- Hero
  section.mb-6.text-center
    h1.text-xl.md_text-2xl.font-semibold.text-text-primary.mb-2
      | One click → To your AI. Any content.

    p.text-sm.text-text-secondary
      | YouTube, articles, docs. Extract and send to Claude, ChatGPT, or any assistant you already use. One source or twenty.

  //- Formulaire
  section.mb-4
    form.relative(action="/create" method="POST")
      #empty-error.absolute.left-0.right-0.text-center.text-sm.text-red-400(style="top: -1.5rem; opacity: 0; transition: opacity 300ms ease; pointer-events: none;")
      textarea.w-full.px-3.py-2.border.border-border-strong.rounded-md.text-base.focus_outline-none.focus_border-text-muted.resize-none.font-mono.text-sm.bg-surface.text-text-primary(
        name="urls"
        rows="4"
        placeholder="https://youtube.com/watch?v=...\nhttps://example.com/article"
        required
      )
      .relative.mt-3#send-to-wrapper
        button#submit-btn.w-full.bg-red-600.hover_bg-red-700.text-white.px-4.py-3.rounded-md.text-sm.font-medium(type="button")
          | Extract, Combine &amp; Send to...
        #send-to-menu.hidden.absolute.left-0.bg-surface.border.rounded-md(style="z-index:50; padding: 1.25rem 1.5rem; box-sizing: border-box; margin-top: 0.25rem; border-color: #dc2626;")
          .flex.flex-wrap.justify-center(style="gap: 0.75rem;")
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="claude" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Claude
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="chatgpt" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") ChatGPT
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="gemini" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Gemini
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="perplexity" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Perplexity
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="grok" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Grok
            button.send-to-item.text-sm.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover(type="button" data-llm="copilot" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Copilot
          .flex.items-center(style="margin-top: 1rem;")
            .flex-1.border-t.border-border-default
            .text-xs.text-text-muted(style="padding: 0 0.75rem;") or
            .flex-1.border-t.border-border-default
          .flex.justify-center(style="gap: 0.75rem; margin-top: 1rem;")
            button.send-to-item.text-xs.rounded-md.border.bg-surface.text-text-muted.hover_text-text-primary.hover_bg-surface-hover(type="button" data-action="copy-link" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Copy link
            button.send-to-item.text-xs.rounded-md.border.bg-surface.text-text-muted.hover_text-text-primary.hover_bg-surface-hover(type="button" data-action="copy-md" style="padding: 0.5rem 1rem; border-color: rgba(220,38,38,0.35);") Copy markdown
          if x10s && x10s.length > 0
            .flex.items-center(style="margin-top: 1rem;")
              .flex-1.border-t.border-border-default
              .text-xs.text-text-muted(style="padding: 0 0.75rem;") or
              .flex-1.border-t.border-border-default
            .text-xs.text-text-muted.text-center(style="margin-top: 0.75rem;") Add to collection
              .flex.flex-col(style="gap: 0.5rem; margin-top: 1rem;")
                each x10 in x10s
                  - var firstItem = x10.videos && x10.videos[0]
                  - var isYT = firstItem && (firstItem.type === 'youtube' || firstItem.youtube_id)
                  - var thumb = isYT ? 'https://img.youtube.com/vi/' + firstItem.youtube_id + '/default.jpg' : null
                  - var favicon = firstItem && !isYT ? 'https://www.google.com/s2/favicons?domain=' + firstItem.channel + '&sz=32' : null
                  - var itemCount = x10.videos ? x10.videos.length : 0
                  - var tokenDisplay = x10.tokenCount > 1000 ? Math.round(x10.tokenCount / 1000) + 'K tokens' : x10.tokenCount + ' tokens'
                  button.send-to-item.flex.items-center.rounded-md.border.bg-surface.text-text-primary.hover_bg-surface-hover.text-left(type="button" data-action="add-to-collection" data-collection-id=x10.id data-original-text=(x10.title || 'Untitled') style="padding: 0.4rem 0.75rem; border-color: rgba(220,38,38,0.35); gap: 0.6rem;")
                    if thumb
                      img(src=thumb style="width: 40px; height: 24px; object-fit: cover; border-radius: 3px; flex-shrink: 0;")
                    else if favicon
                      .flex.items-center.justify-center(style="width: 40px; height: 24px; flex-shrink: 0;")
                        img(src=favicon style="width: 16px; height: 16px;")
                    else
                      .bg-surface-alt.rounded(style="width: 40px; height: 24px; flex-shrink: 0;")
                    .min-w-0.flex-1
                      .text-xs.truncate= x10.title || 'Untitled'
                      .text-text-muted(style="font-size: 0.65rem;") #{itemCount} item#{itemCount > 1 ? 's' : ''} · #{tokenDisplay}

    if error
      .bg-red-900.border.border-red-700.rounded-md.p-3.mt-3.text-red-200.text-sm
        p= error
        if failedUrls && failedUrls.length > 0
          ul.mt-2.list-disc.list-inside
            each fail in failedUrls
              li #{fail.url}: #{fail.error}

  //- Extension + LLMs
  p.text-center.text-sm.text-text-muted.mb-2
    | Or use the
    a.text-red-600(href="https://chromewebstore.google.com/detail/toyourai/xxxxxxxx" target="_blank")  Chrome extension
    |  to collect pages as you browse.

  .mb-8

  //- Why
  section.py-6.border-t.border-border-default
    h2.text-base.font-medium.mb-4 Why this exists

    .space-y-3.text-sm.text-text-secondary
      p I just wanted to send stuff to Claude or GPT without subscriptions, import wizards, or some chat I didn't ask for.
      p Other tools make you use their chat. I don't want their chat. I want my assistant, the one that knows my style, my projects, my context.
      p I couldn't find a tool that just did that. Paste URLs, click, boom: straight to my assistant.
      p No "create a workspace" flow. No "pro" and "ultra" tiers.

  //- Use cases
  section.py-6.border-t.border-border-default
    h2.text-base.font-medium.mb-3 What you can do

    ul.text-sm.text-text-secondary.space-y-1
      li Drop 5 laptop reviews, ask "which one for video editing?"
      li 6 podcasts, 8 hours: key points in one click
      li 12 articles and 4 videos on a topic, one page, ready to learn

  //- How it works
  section.py-6.border-t.border-border-default
    h2.text-base.font-medium.mb-3 How it works

    p.text-sm.text-text-secondary Extracts content, combines it into one markdown page, and gives your AI the link to fetch it. With customizable instructions.

  //- FAQ
  section.py-6.border-t.border-border-default
    h2.text-base.font-medium.mb-3 FAQ

    .space-y-3.text-sm
      div
        p.text-text-primary Is it free?
        p.text-text-muted Yes. No account needed.

      div
        p.text-text-primary Is my data private?
        p.text-text-muted Conversations happen in your own assistant. You're identified by a random code, no email, no signup. Delete your pages anytime.

      div
        p.text-text-primary Can I sync between devices?
        p.text-text-muted There's no sync feature, but your content is tied to a user code. Enter it on another device to access your pages.

  //- Script
  script.
    (function() {
      var LLM_URLS = {
        claude: function(p) { return 'https://claude.ai/new?q=' + encodeURIComponent(p); },
        chatgpt: function(p) { return 'https://chat.openai.com/?q=' + encodeURIComponent(p); },
        gemini: function(p) { return 'https://www.google.com/search?udm=50&aep=11&q=' + encodeURIComponent(p); },
        perplexity: function(p) { return 'https://www.perplexity.ai/search/?q=' + encodeURIComponent(p); },
        grok: function(p) { return 'https://x.com/i/grok?text=' + encodeURIComponent(p); },
        copilot: function(p) { return 'https://copilot.microsoft.com/?q=' + encodeURIComponent(p); }
      };

      var form = document.querySelector('form[action="/create"]');
      var submitBtn = document.getElementById('submit-btn');
      var menu = document.getElementById('send-to-menu');
      var wrapper = document.getElementById('send-to-wrapper');
      var hideTimeout = null;
      var showTimeout = null;

      // Transition setup
      menu.style.opacity = '0';
      menu.style.transition = 'opacity 150ms ease';

      function syncMenuWidth() {
        menu.style.width = submitBtn.offsetWidth + 'px';
      }
      function showMenu() {
        syncMenuWidth();
        menu.classList.remove('hidden');
        // Force reflow then fade in
        menu.offsetHeight;
        menu.style.opacity = '1';
      }
      function hideMenu() {
        menu.style.opacity = '0';
        setTimeout(function() {
          if (menu.style.opacity === '0') menu.classList.add('hidden');
        }, 150);
      }
      window.addEventListener('resize', function() {
        if (!menu.classList.contains('hidden')) syncMenuWidth();
      });

      // Show/hide menu on hover
      wrapper.addEventListener('mouseenter', function() {
        clearTimeout(hideTimeout);
        clearTimeout(showTimeout);
        showTimeout = setTimeout(showMenu, 120);
      });
      wrapper.addEventListener('mouseleave', function() {
        clearTimeout(showTimeout);
        hideTimeout = setTimeout(hideMenu, 1000);
      });

      // Toggle on click
      submitBtn.addEventListener('click', function() {
        if (menu.classList.contains('hidden')) { showMenu(); } else { hideMenu(); }
      });

      // Close menu on outside click
      document.addEventListener('click', function(e) {
        if (!wrapper.contains(e.target)) {
          hideMenu();
        }
      });

      // Handle menu item clicks
      document.querySelectorAll('.send-to-item').forEach(function(item) {
        item.addEventListener('click', function() {
          var llm = this.dataset.llm;
          var action = this.dataset.action;
          hideMenu();

          // Validate textarea
          var textarea = form.querySelector('textarea');
          if (!textarea.value.trim()) {
            textarea.focus();
            var errEl = document.getElementById('empty-error');
            errEl.textContent = 'Paste at least one URL below.';
            errEl.style.opacity = '1';
            setTimeout(function() { errEl.style.opacity = '0'; }, 3000);
            return;
          }

          // Add to existing collection: different flow
          if (action === 'add-to-collection') {
            var collectionId = this.dataset.collectionId;
            var urls = textarea.value.trim().split('\n').filter(function(u) { return u.trim(); });
            var clickedBtn = this;
            clickedBtn.textContent = 'Adding...';
            submitBtn.disabled = true;

            var addNext = function(i) {
              if (i >= urls.length) {
                clickedBtn.textContent = 'Added!';
                submitBtn.disabled = false;
                setTimeout(function() { clickedBtn.textContent = clickedBtn.getAttribute('data-original-text'); }, 2000);
                return;
              }
              fetch('/s/' + collectionId + '/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Accept': 'application/json' },
                body: 'url=' + encodeURIComponent(urls[i].trim())
              })
              .then(function(res) { return res.json(); })
              .then(function() { addNext(i + 1); })
              .catch(function() { addNext(i + 1); });
            };
            addNext(0);
            return;
          }

          submitBtn.disabled = true;
          submitBtn.textContent = 'Extracting...';

          fetch('/create', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
              'Accept': 'application/json'
            },
            body: new URLSearchParams(new FormData(form))
          })
          .then(function(res) { return res.json().then(function(data) { return { ok: res.ok, data: data }; }); })
          .then(function(result) {
            if (!result.ok) {
              alert(result.data.error || 'Something went wrong');
              return;
            }

            var d = result.data;
            var mdUrl = d.mdUrl;
            var prompt = 'Fetch ' + mdUrl;

            if (llm) {
              window.open(LLM_URLS[llm](prompt), '_blank');
            } else if (action === 'copy-link') {
              navigator.clipboard.writeText(mdUrl);
            } else if (action === 'copy-md') {
              fetch(mdUrl)
                .then(function(r) { return r.text(); })
                .then(function(md) { navigator.clipboard.writeText(md); });
            }

            submitBtn.textContent = 'Done';
            setTimeout(function() {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Extract, Combine & Send to...';
            }, 2000);
          })
          .catch(function(err) {
            alert('Error: ' + err.message);
          })
          .finally(function() {
            if (submitBtn.textContent === 'Extracting...') {
              submitBtn.disabled = false;
              submitBtn.textContent = 'Extract, Combine & Send to...';
            }
          });
        });
      });
    })();
